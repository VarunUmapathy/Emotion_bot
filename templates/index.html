<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Nila - Your Voice Assistant</title>
    <style>
        :root {
            --waveform-url: url('{{ url_for("static", filename="Audio Wave.gif") }}');
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1e293b;
            color: #f0f9ff;
            text-align: center;
            margin: 0;
            padding-top: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        h1 {
            color: #a5f3fc;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        p {
            color: #cbd5e1;
            margin-bottom: 20px;
        }
        button {
            font-size: 1.1em;
            padding: 12px 25px;
            margin: 10px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            background-color: #3b82f6;
            color: #f0f9ff;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #2563eb;
        }
        #status-container {
            margin-top: 30px;
            font-size: 1.2em;
            color: #a5f3fc;
            font-weight: bold;
        }
        #waveform-animation {
            width: 80%;
            max-width: 600px;
            height: 80px;
            background-image: var(--waveform-url);
            background-repeat: repeat-x;
            background-size: contain;
            margin: 20px auto;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .talking {
            opacity: 1 !important;
        }
    </style>
</head>
<body>
    <h1>Nila - Your Voice Assistant</h1>
    <p>Interact with Nila using the buttons below.</p>
    <button id="startBtn">Start Listening</button>
    <button id="stopBtn">Stop Listening</button>
    <div id="status-container">Status: <span id="status">Idle</span></div>
    
    <div id="waveform-animation"></div>

    <script>
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const statusElement = document.getElementById('status');
        const waveformAnimation = document.getElementById('waveform-animation');

        let statusPollingInterval;

        function updateStatusDisplay(status) {
            statusElement.textContent = status;
            if (status.includes("is speaking")) {
                waveformAnimation.classList.add('talking');
            } else {
                waveformAnimation.classList.remove('talking');
            }
        }

        function startStatusPolling() {
            if (statusPollingInterval) {
                clearInterval(statusPollingInterval);
            }
            statusPollingInterval = setInterval(() => {
                fetch('/get_status')
                    .then(response => response.json())
                    .then(data => {
                        updateStatusDisplay(data.status);
                    })
                    .catch(error => console.error('Error fetching status:', error));
            }, 1000); // Poll every 1 second
        }

        function stopStatusPolling() {
            clearInterval(statusPollingInterval);
            statusPollingInterval = null;
            updateStatusDisplay("Idle");
        }

        startBtn.addEventListener('click', () => {
            fetch('/start_bot', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    startStatusPolling();
                })
                .catch(error => console.error('Error starting bot:', error));
        });

        stopBtn.addEventListener('click', () => {
            fetch('/stop_bot', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    stopStatusPolling();
                })
                .catch(error => console.error('Error stopping bot:', error));
        });
        
        // Initial status update
        updateStatusDisplay("Idle");
    </script>
</body>
</html>